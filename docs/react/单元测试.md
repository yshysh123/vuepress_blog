---
title: å•å…ƒæµ‹è¯•åˆ†äº«
sidebar: false
date: 2020-08-03
categories:
  - React å­¦ä¹ ç¬”è®°
tags:
  - react
  - å•å…ƒæµ‹è¯•
  - vue
---

:::tip
å•å…ƒæµ‹è¯•åˆ†äº«
æœ¬åˆ†äº«çš„æ ¸å¿ƒä¸æ˜¯å¦‚ä½•å†™å•å…ƒæµ‹è¯•ï¼Œæ›´æƒ³åˆ†äº«çš„æ˜¯ä¸€ç§æ€è·¯ï¼Œè®©æˆ‘ä»¬åœ¨å†™å‡½æ•°ã€ç»„ä»¶ã€é¡µé¢çš„æ—¶å€™ï¼Œç”¨å¯æµ‹è¯•æ€§çš„æ€è·¯è¿›è¡Œç¼–ç 
:::

<!-- more -->

## å‰è¨€

é•¿æœŸä»¥æ¥ï¼Œå‰ç«¯å¼€å‘çš„å•å…ƒæµ‹è¯•å¹¶ä¸æ˜¯åœ¨å‰ç«¯çš„å¼€å‘è¿‡ç¨‹ä¸­æ‰€å¿…é¡»çš„ï¼Œä¹Ÿä¸æ˜¯æ¯ä¸ªå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆæ‰€æ³¨æ„å’Œé‡è§†çš„ï¼Œ<br />
ç”šè‡³æ‰©å¤§åˆ°è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­å•å…ƒæµ‹è¯•è¿™ä¸€ç¯ä¹Ÿä¸æ˜¯åœ¨ç« ç¨‹ä¸Šæœ‰ä¹¦é¢è§„å®šæ‰€è¦æ±‚çš„ã€‚æ›¾ç»çš„æˆ‘ä¹Ÿé—®è¿‡è®¸å¤šæ¬¡è‡ªå·±ä»¥åŠèº«è¾¹çš„å‰ç«¯å·¥ç¨‹å¸ˆã€‚<br />
ä¸ºä»€ä¹ˆå‰ç«¯è¦å†™å•å…ƒæµ‹è¯•ï¼Ÿå‰ç«¯çš„å•å…ƒæµ‹è¯•å’Œæµ‹è¯•å·¥ç¨‹å¸ˆçš„æµ‹è¯•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒèŠ±è´¹å¤§é‡æ—¶é—´çš„æ—¶é—´å»å†™å•å…ƒæµ‹è¯•å€¼ä¸å€¼å¾—ï¼Ÿ

### ä¸ºä»€ä¹ˆè¦è¿›è¡Œæµ‹è¯•ï¼Ÿï¼Ÿ

1. æµ‹è¯•å¯ä»¥ç¡®ä¿å¾—åˆ°é¢„æœŸçš„ç»“æœ
2. ä½œä¸ºç°æœ‰ä»£ç è¡Œä¸ºçš„æè¿°
3. ä¿ƒä½¿å¼€å‘è€…å†™å¯æµ‹è¯•çš„ä»£ç ï¼Œä¸€èˆ¬å¯æµ‹è¯•çš„ä»£ç å¯è¯»æ€§ä¹Ÿä¼šé«˜ä¸€ç‚¹
4. å¦‚æœä¾èµ–çš„ç»„ä»¶æœ‰ä¿®æ”¹ï¼Œå—å½±å“çš„ç»„ä»¶èƒ½åœ¨æµ‹è¯•ä¸­å‘ç°é”™è¯¯
5. å¯¹å¼€æºå¸®åŠ©å·¨å¤§

### æµ‹è¯•ç±»å‹

- å•å…ƒæµ‹è¯•ï¼šæŒ‡çš„æ˜¯ä»¥åŸä»¶çš„å•å…ƒä¸ºå•ä½ï¼Œå¯¹è½¯ä»¶è¿›è¡Œæµ‹è¯•ã€‚å•å…ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ¨¡å—æˆ–ä¸€ä¸ªç»„ä»¶ï¼ŒåŸºæœ¬ç‰¹å¾å°±æ˜¯åªè¦è¾“å…¥ä¸å˜ï¼Œå¿…å®šè¿”å›åŒæ ·çš„è¾“å‡ºã€‚ä¸€ä¸ªè½¯ä»¶è¶Šå®¹æ˜“å†™å•å…ƒæµ‹è¯•ï¼Œå°±è¡¨æ˜å®ƒçš„æ¨¡å—åŒ–ç»“æ„è¶Šå¥½ï¼Œç»™æ¨¡å—ä¹‹é—´çš„è€¦åˆè¶Šå¼±ã€‚React çš„ç»„ä»¶åŒ–å’Œå‡½æ•°å¼ç¼–ç¨‹ï¼Œå¤©ç”Ÿé€‚åˆè¿›è¡Œå•å…ƒæµ‹è¯•
- åŠŸèƒ½æµ‹è¯•ï¼šç›¸å½“äºæ˜¯é»‘ç›’æµ‹è¯•ï¼Œæµ‹è¯•è€…ä¸äº†è§£ç¨‹åºçš„å†…éƒ¨æƒ…å†µï¼Œä¸éœ€è¦å…·å¤‡ç¼–ç¨‹è¯­è¨€çš„ä¸“é—¨çŸ¥è¯†ï¼ŒåªçŸ¥é“ç¨‹åºçš„è¾“å…¥ã€è¾“å‡ºå’ŒåŠŸèƒ½ï¼Œä»ç”¨æˆ·çš„è§’åº¦é’ˆå¯¹è½¯ä»¶ç•Œé¢ã€åŠŸèƒ½å’Œå¤–éƒ¨ç»“æ„è¿›è¡Œæµ‹è¯•ï¼Œä¸è€ƒè™‘å†…éƒ¨çš„é€»è¾‘
- é›†æˆæµ‹è¯•ï¼šåœ¨å•å…ƒæµ‹è¯•çš„åŸºç¡€ä¸Šï¼Œå°†æ‰€æœ‰æ¨¡å—æŒ‰ç…§è®¾è®¡è¦æ±‚ç»„è£…æˆå­ç³»ç»Ÿæˆ–è€…ç³»ç»Ÿï¼Œè¿›è¡Œæµ‹è¯•
- å†’çƒŸæµ‹è¯•ï¼šåœ¨æ­£å¼å…¨é¢çš„æµ‹è¯•ä¹‹å‰ï¼Œå¯¹ä¸»è¦åŠŸèƒ½è¿›è¡Œçš„æµ‹è¯•ï¼Œç¡®è®¤ä¸»è¦åŠŸèƒ½æ˜¯å¦æ»¡è¶³éœ€è¦ï¼Œè½¯ä»¶æ˜¯å¦èƒ½æ­£å¸¸è¿è¡Œ

### å¼€å‘æ¨¡å¼

- TDD: æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œè‹±æ–‡ä¸º Testing Driven Developmentï¼Œå¼ºè°ƒçš„æ˜¯ä¸€ç§å¼€å‘æ–¹å¼ï¼Œä»¥æµ‹è¯•æ¥é©±åŠ¨æ•´ä¸ªé¡¹ç›®ï¼Œå³å…ˆæ ¹æ®æ¥å£å®Œæˆæµ‹è¯•ç¼–å†™ï¼Œç„¶ååœ¨å®ŒæˆåŠŸèƒ½æ˜¯è¦ä¸æ–­é€šè¿‡æµ‹è¯•ï¼Œæœ€ç»ˆç›®çš„æ˜¯é€šè¿‡æ‰€æœ‰æµ‹è¯•
- BDD: è¡Œä¸ºé©±åŠ¨å¼€å‘ï¼Œè‹±æ–‡ä¸º Behavior Driven Developmentï¼ŒBDD çš„æ ¸å¿ƒä»·å€¼æ˜¯ä½“ç°åœ¨æ­£ç¡®çš„å¯¹ç³»ç»Ÿè¡Œä¸ºè¿›è¡Œè®¾è®¡ï¼Œæ‰€ä»¥å®ƒå¹¶éä¸€ç§è¡Œä¹‹æœ‰æ•ˆçš„æµ‹è¯•æ–¹æ³•ã€‚å®ƒå¼ºè°ƒçš„æ˜¯ç³»ç»Ÿæœ€ç»ˆçš„å®ç°ä¸ç”¨æˆ·æœŸæœ›çš„è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€éªŒè¯ä»£ç å®ç°æ˜¯å¦ç¬¦åˆè®¾è®¡ç›®æ ‡ã€‚ä½†æ˜¯å®ƒæœ¬èº«å¹¶ä¸å¼ºè°ƒå¯¹ç³»ç»ŸåŠŸèƒ½ã€æ€§èƒ½ä»¥åŠè¾¹ç•Œå€¼ç­‰çš„å¥å…¨æ€§åšä¿è¯ï¼Œæ— æ³•åƒå®Œæ•´çš„æµ‹è¯•ä¸€æ ·å‘ç°ç³»ç»Ÿçš„å„ç§é—®é¢˜ã€‚ä½† BDD å€¡å¯¼çš„ç”¨ç®€æ´çš„è‡ªç„¶è¯­è¨€æè¿°ç³»ç»Ÿè¡Œä¸ºçš„ç†å¿µï¼Œå¯ä»¥æ˜ç¡®çš„æ ¹æ®è®¾è®¡äº§ç”Ÿæµ‹è¯•ï¼Œå¹¶ä¿éšœæµ‹è¯•ç”¨ä¾‹çš„è´¨é‡ã€‚
- DDD: Domain-drive Design,é¢†åŸŸé©±åŠ¨è®¾è®¡ã€‚å…¶ç›®çš„æ˜¯ä»¥ä¸€ç§é¢†åŸŸä¸“å®¶ã€è®¾è®¡äººå‘˜ã€å¼€å‘äººå‘˜éƒ½èƒ½ç†è§£çš„é€šç”¨è¯­è¨€ä½œä¸ºç›¸äº’äº¤æµçš„å·¥å…·ï¼Œåœ¨äº¤æµçš„è¿‡ç¨‹ä¸­å‘ç°é¢†åŸŸæ¦‚å¿µï¼Œç„¶åå°†è¿™äº›æ¦‚å¿µè®¾è®¡æˆä¸€ä¸ªé¢†åŸŸæ¨¡å‹ï¼Œå†æœ‰è¯¥æ¨¡å‹é©±åŠ¨è½¯ä»¶è®¾è®¡å’Œå¼€å‘ã€‚

TDD å’Œ BDD æœ‰å„è‡ªçš„ä½¿ç”¨åœºæ™¯ï¼ŒBDD ä¸€èˆ¬åå‘äºç³»ç»ŸåŠŸèƒ½å’Œä¸šåŠ¡é€»è¾‘çš„è‡ªåŠ¨åŒ–æµ‹è¯•è®¾è®¡ï¼›è€Œ TDD åœ¨å¿«é€Ÿå¼€å‘å¹¶æµ‹è¯•åŠŸèƒ½æ¨¡å—çš„è¿‡ç¨‹ä¸­åˆ™æ›´åŠ é«˜æ•ˆï¼Œä»¥å¿«é€Ÿå®Œæˆå¼€å‘ä¸ºç›®çš„ã€‚DDD åˆ™è¾ƒä¸ºå¤æ‚

## å•å…ƒæµ‹è¯•å·¥å…·

è¯´èµ·å•å…ƒæµ‹è¯•ï¼Œå¸‚é¢ä¸Šçš„å•å…ƒæµ‹è¯•å·¥å…·å½¢å½¢è‰²è‰²ï¼Œäº”èŠ±å…«é—¨ã€‚æœ€å¸¸ä½¿ç”¨çš„å·¥å…·ä¸º:Jest Mocha Jasmine

- ğŸ›  å·¥å…·[Jest](https://www.npmjs.com/package/eslint)
  å®‰è£…

  ```bash
  yarn add jest //é¡¹ç›®å®‰è£…
  yarn add jest -g //å…¨å±€å®‰è£…
  ```

  - facebook ååº„
  - åŸºäº Jasmine è‡³ä»Šå·²ç»åšäº†å¤§é‡ä¿®æ”¹æ·»åŠ äº†å¾ˆå¤šç‰¹æ€§
  - å¼€ç®±å³ç”¨é…ç½®å°‘ï¼ŒAPI ç®€å•
  - æ”¯æŒæ–­è¨€å’Œä»¿çœŸ
  - æ”¯æŒå¿«ç…§æµ‹è¯•
  - åœ¨éš”ç¦»ç¯å¢ƒä¸‹æµ‹è¯•
  - äº’åŠ¨æ¨¡å¼é€‰æ‹©è¦æµ‹è¯•çš„æ¨¡å—
  - ä¼˜é›…çš„æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼ŒåŸºäº Istanbul
  - å…¨å±€ç¯å¢ƒï¼Œæ¯”å¦‚ describe ä¸éœ€è¦å¼•å…¥ç›´æ¥ç”¨

- ğŸ›  å·¥å…·[Mocha](https://mochajs.org/)
  å®‰è£…

  ```bash
  yarn add mocha
  ```

  - çµæ´»(ä¸åŒ…æ‹¬æ–­è¨€å’Œä»¿çœŸï¼Œè‡ªå·±é€‰å¯¹åº”å·¥å…·)
  - æµè¡Œçš„é€‰æ‹©ï¼šchaiï¼Œsinon
  - ç¤¾åŒºæˆç†Ÿç”¨çš„äººå¤šï¼Œæµ‹è¯•å„ç§ä¸œè¥¿ç¤¾åŒºéƒ½æœ‰ç¤ºä¾‹
  - éœ€è¦è¾ƒå¤šé…ç½®
  - å¯ä»¥ä½¿ç”¨å¿«ç…§æµ‹è¯•ï¼Œä½†ä¾ç„¶éœ€è¦é¢å¤–é…ç½®

ä¸ªäººæ¨èä½¿ç”¨ jest è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚ç†ç”±å¦‚ä¸‹ï¼š

- jest ä¸ babel å¯¹ es6 çš„è½¬ç é›†æˆè‰¯å¥½ã€‚
- jest çš„ api æ–‡æ¡£å®Œæ•´ä¸” api è®¾è®¡è‰¯å¥½ã€‚
- jest å¯¹å¼‚æ­¥ä»£ç æµ‹è¯•å†…ç½®æ”¯æŒå®Œå–„ã€‚
- jest å†…ç½®å®Œå–„çš„ mock ä¸ stub å·¥å…·ã€‚
- jest è¿è¡Œå¦‚é£ã€‚
- jest å¯è‡ªè°ƒç”¨ istanbulï¼Œæ— ç—›ç”Ÿæˆè¦†ç›–ç‡ç»Ÿè®¡æ–‡æ¡£ã€‚
- jest ä½¿ç”¨çº¦å®šå¤§äºé…ç½®çš„åŸåˆ™ï¼Œéœ€é…ç½®é¡¹è¾ƒå°‘ï¼Œä¸”åŒæ—¶å…¼é¡¾å®šåˆ¶éœ€æ±‚ã€‚
- ä½¿ç”¨ jsdomï¼Œåœ¨ nodejs ç¯å¢ƒå¯æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼Œä¸ jest é›†æˆåæµ‹è¯•å‰ç«¯çš„æµè§ˆå™¨ç¯å¢ƒä»£ç ã€‚
- jest æ–‡æ¡£ä¸°å¯Œä¸”æœ‰å¹¿æ³›çš„å¼€å‘è€…åŸºç¡€ã€‚

[Jest å¸¸ç”¨ API](https://jestjs.io/docs/en/api.html)

- describe(name, fn)ï¼šæè¿°å—ï¼Œè®²ä¸€ç»„åŠŸèƒ½ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹ç»„åˆåœ¨ä¸€èµ·
- it(name, fn, timeout)ï¼šåˆ«å testï¼Œç”¨æ¥æ”¾æµ‹è¯•ç”¨ä¾‹
- afterAll(fn, timeout)ï¼šæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹è·‘å®Œä»¥åæ‰§è¡Œçš„æ–¹æ³•
- beforeAll(fn, timeout)ï¼šæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œä¹‹å‰æ‰§è¡Œçš„æ–¹æ³•
- afterEach(fn)ï¼šåœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå®Œåæ‰§è¡Œçš„æ–¹æ³•
- beforeEach(fn)ï¼šåœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ‰§è¡Œä¹‹å‰éœ€è¦æ‰§è¡Œçš„æ–¹æ³•

[Enzyme](https://enzymejs.github.io/enzyme/)

Enzyme æ˜¯ Airbnb å¼€æºçš„ React æµ‹è¯•å·¥å…·åº“åº“ï¼Œå®ƒåŠŸèƒ½è¿‡å¯¹å®˜æ–¹çš„æµ‹è¯•å·¥å…·åº“ ReactTestUtils çš„äºŒæ¬¡å°è£…ï¼Œæä¾›äº†ä¸€å¥—ç®€æ´å¼ºå¤§çš„ APIã€‚
å®ç°äº† jQuery é£æ ¼çš„æ–¹å¼è¿›è¡Œ DOM å¤„ç†ï¼Œå¼€å‘ä½“éªŒååˆ†å‹å¥½ã€‚åœ¨å¼€æºç¤¾åŒºæœ‰è¶…é«˜äººæ°”ï¼ŒåŒæ—¶ä¹Ÿè·å¾—äº† React å®˜æ–¹çš„æ¨èã€‚

[Vue Test Utils](https://vue-test-utils.vuejs.org/zh/)

Vue Test Utils æ˜¯ Vue.js å®˜æ–¹çš„å•å…ƒæµ‹è¯•å®ç”¨å·¥å…·åº“

**æµ‹è¯•çš„æ¸è¿›æ€§ï¼š**

![æµ‹è¯•é‡‘å­—å¡”](./image/testPyramid.jpg)

**æœ€ç»ˆä¸ºäº†å„ç§åœºæ™¯ä¸‹ React çš„å•å…ƒæµ‹è¯•ï¼Œé›†æˆäº†ä¸‹é¢çš„ libï¼š**

- Jestï¼šå•å…ƒæµ‹è¯•æ¡†æ¶
- enzymeï¼š React æµ‹è¯•åº“
- enzyme-adapter-react-16ï¼š enzyme å’Œ React çš„é…å¥—åº“ ç”¨äºä¿è¯ enzyme æ¸²æŸ“çš„ç‰ˆæœ¬å’Œä½ ä½¿ç”¨çš„ React ç‰ˆæœ¬æ˜¯ä¸€è‡´çš„ã€‚
- fetch-mockï¼š å¼‚æ­¥è¯·æ±‚æ¨¡æ‹Ÿ
- babel-7-jest:Jest å¯¹åº”çš„ babel
- eslint-plugin-jestï¼šjest å¯¹åº”çš„ eslint
- jsdomï¼šè™šæ‹Ÿ dom ç¯å¢ƒ

**æœ€ç»ˆä¸ºäº†å„ç§åœºæ™¯ä¸‹ Vue çš„å•å…ƒæµ‹è¯•ï¼Œé›†æˆäº†ä¸‹é¢çš„ libï¼š**

- Jestï¼šå•å…ƒæµ‹è¯•æ¡†æ¶
- fetch-mockï¼š å¼‚æ­¥è¯·æ±‚æ¨¡æ‹Ÿ
- Vue Test Utilsï¼šVue.js å®˜æ–¹çš„å•å…ƒæµ‹è¯•å®ç”¨å·¥å…·åº“
- babel-7-jest:Jest å¯¹åº”çš„ babel
- eslint-plugin-jestï¼šjest å¯¹åº”çš„ eslint
- jsdomï¼šè™šæ‹Ÿ dom ç¯å¢ƒ

---

**ä¸‹é¢ä¸»è¦ä»‹ç» React çš„å•å…ƒæµ‹è¯•æµç¨‹**

## å‡½æ•°å¼å•å…ƒæµ‹è¯•

### æµ‹è¯•å‰é¡»çŸ¥

1. ä½¿ç”¨ Jest è¿›è¡Œå•å…ƒæµ‹è¯•å°½é‡ä¿è¯æ˜¯çº¯å‡½æ•°ã€‚å³å‡½æ•°æœ‰å…¥å‚å¹¶ä»¥ return ç»“å°¾ã€‚
2. å‡½æ•°å°½é‡ä¸è¦ä¾èµ–å¤–éƒ¨å˜é‡ã€‚
3. react å‡½æ•°ï¼ˆè¿”å›å€¼ä¸º JSXï¼‰ä¸å±äºè¯¥æµ‹è¯•èŒƒå›´
4. jest é…ç½®ï¼šåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º jest.config.jsã€‚

### æµ‹è¯•æ­¥éª¤

1. å†™ä¸€ä¸ªçº¯å‡½æ•°

```javascript
/**
 * @category String
 * @description å»é™¤å…¨éƒ¨ç©ºæ ¼
 * @author xufeng
 * @date 2020-07-10
 * @export
 * @param {string} string
 * @returns {string}
 */
export function trimAll(string: string): string {
  return (string || '').replace(/[\s\uFEFF]+|[\s\uFEFF]+/g, '');
}
```

2. åœ¨**test**æ–‡ä»¶å¤¹ä¸‹å»ºä¸€ä¸ªæ–‡ä»¶ fn.test.js

3. è¿›è¡Œå•å…ƒæµ‹è¯•

```javascript
import { trimAll } from '@/string';

describe('string', function() {
  describe('trim', function() {
    it('å‰é¢æœ‰ç©ºæ ¼', function() {
      expect(trimAll(' 123')).toBe('123');
    });
    it('ä¸­é—´æœ‰ç©ºæ ¼', function() {
      expect(trimAll('12 3')).toBe('123');
    });
    it('åé¢æœ‰ç©ºæ ¼', function() {
      expect(trimAll('123 ')).toBe('123');
    });
    it('éƒ½æ˜¯ç©ºæ ¼', function() {
      expect(trimAll(' 1 2 3 ')).toBe('123');
    });
    it('ä¼ ç©º', function() {
      expect(trimAll('')).toBe('');
    });
  });
});
```

## ç»„ä»¶å•å…ƒæµ‹è¯•

### enzyme3 ç§æ¸²æŸ“æ–¹å¼ä»‹ç»

**ä¸‰ç§æ¸²æŸ“æ–¹æ³•**

- shallowï¼šæµ…æ¸²æŸ“ï¼Œæ˜¯å¯¹å®˜æ–¹çš„ Shallow Renderer çš„å°è£…ã€‚å°†ç»„ä»¶æ¸²æŸ“æˆè™šæ‹Ÿ DOM å¯¹è±¡ï¼Œåªä¼šæ¸²æŸ“ç¬¬ä¸€å±‚ï¼Œå­ç»„ä»¶å°†ä¸ä¼šè¢«æ¸²æŸ“å‡ºæ¥ï¼Œä½¿å¾—æ•ˆç‡éå¸¸é«˜ã€‚ä¸éœ€è¦ DOM ç¯å¢ƒï¼Œ å¹¶å¯ä»¥ä½¿ç”¨ jQuery çš„æ–¹å¼è®¿é—®ç»„ä»¶çš„ä¿¡æ¯
- renderï¼šé™æ€æ¸²æŸ“ï¼Œå®ƒå°† React ç»„ä»¶æ¸²æŸ“æˆé™æ€çš„ HTML å­—ç¬¦ä¸²ï¼Œç„¶åä½¿ç”¨ Cheerio è¿™ä¸ªåº“è§£æè¿™æ®µå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ä¸€ä¸ª Cheerio çš„å®ä¾‹å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥åˆ†æç»„ä»¶çš„ html ç»“æ„
- mountï¼šå®Œå…¨æ¸²æŸ“ï¼Œå®ƒå°†ç»„ä»¶æ¸²æŸ“åŠ è½½æˆä¸€ä¸ªçœŸå®çš„ DOM èŠ‚ç‚¹ï¼Œç”¨æ¥æµ‹è¯• DOM API çš„äº¤äº’å’Œç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚ç”¨åˆ°äº† jsdom æ¥æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒ

### æµ‹è¯•å‰é¡»çŸ¥

1. ä½¿ç”¨ Jest è¿›è¡Œç»„ä»¶æµ‹è¯•éœ€è¦æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼Œç›®å‰ä¸ react é…åˆè¾ƒå¥½çš„æ˜¯ enzyme åŠ jsdomã€‚
2. ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹åªåšä¸€ä»¶äº‹ï¼Œæ‰€ä»¥å°½å¯èƒ½å°†ç»„ä»¶æ‹†åˆ†ä¸ºæœ€å°å•å…ƒã€‚
3. æ¨¡æ‹Ÿæ•°æ®åŠæ¥å£ä½¿ç”¨ fetch-mock
4. åœ¨æµ‹è¯•ä¹‹å‰æ‰§è¡Œ steup å‡½æ•°å°†æ‰€æœ‰ç¯å¢ƒæ¨¡æ‹Ÿå¥½ï¼Œåœ¨æµ‹è¯•ä¸­ç›´æ¥ä½¿ç”¨å³å¯

### æµ‹è¯•ç»„ä»¶å†…å®¹

1. Props ä¼ å…¥ï¼›
2. ç»„ä»¶åˆ†æ”¯æ¸²æŸ“é€»è¾‘ï¼›
3. äº‹ä»¶è°ƒç”¨å’Œå‚æ•°ä¼ é€’ã€‚

### æµ‹è¯•æ­¥éª¤

å°±æ‹¿ä¸€ä¸ªç®€å•çš„æƒé™é«˜é˜¶ç»„ä»¶åšä¾‹å­ï¼š

```javascript
import React from 'react';
import { Provider } from 'mobx-react';
import { mount } from 'enzyme';
import Permission from 'component/Permission';
import permissionStore from 'store/permission';

const TestPermission = () => (
  <Provider store={{ permissionStore }}>
    <Permission resource="ok">
      <span>hasPermission</span>
    </Permission>
  </Provider>
);

describe('component/Permission', () => {
  it('æµ‹è¯•æ— æƒé™', () => {
    const app = mount(<TestPermission />);
    expect(permissionStore.has('ok')).toBe(false);
    expect(app.text()).toBe(null);
  });

  it('æµ‹è¯•æœ‰æƒé™', () => {
    permissionStore.data.add('ok');
    const app = mount(<TestPermission />);
    expect(permissionStore.has('ok')).toBe(true);
    expect(app.text()).toBe('hasPermission');
  });
});
```

## é¡µé¢çº§åˆ«å•å…ƒæµ‹è¯•

é€šå¸¸é¡µé¢çº§åˆ«çš„å•å…ƒæµ‹è¯•æ˜¯ä¸éœ€è¦å‰ç«¯æ¥åšçš„ã€‚é¡µé¢é€šå¸¸è¢«åˆ†å‰²æˆå¤šä¸ªå…¬ç”¨çš„ç»„ä»¶åŠ Storeï¼ˆMVVM ä¸‹ï¼‰ï¼Œæ•°æ®ä¸è¡¨ç°åˆ†ç¦»ï¼Œå³æ•°æ®å±‚å’Œé€šç”¨ç»„ä»¶å±‚æˆ‘ä»¬å·²ç»é€šè¿‡ä¸Šè¿° 2 ç§æ–¹å¼è¿›è¡Œè¿‡ç›¸åº”çš„å•å…ƒæµ‹è¯•äº†ã€‚é¡µé¢çº§åˆ«çš„æµ‹è¯•é€šå¸¸åªé’ˆå¯¹ç®€å•çš„æ–‡æ¡ˆåŠ CSS è¿›è¡Œæµ‹è¯•å°±å¤Ÿäº†ã€‚

ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥å¯¹ä¸€ä¸ªé¡µé¢çš„è·Ÿç»„ä»¶è¿›è¡Œæµ‹è¯•ï¼š

```javascript
import React from 'react';
import { shallow } from 'enzyme';
import { Card } from 'antd';
import A from 'page/A';
import Operation from 'page/A/Operation';
import List from 'page/A/List';
import Search from 'page/A/Search';
import CardTitle from 'component/CardTitle';

describe('page/A', () => {
  it('æµ‹è¯•é¡µé¢å¯å®Œæ•´æ¸²æŸ“', () => {
    const app = shallow(<A />);
    expect(app.find(Card)).toHaveLength(1);
    expect(app.contains(<Operation />)).toBeTruthy();
    expect(app.contains(<List />)).toBeTruthy();

    // æµ‹è¯•å¯å®Œæ•´æ¸²æŸ“Card titleå±æ€§
    const title = app.find(Card).prop('title');
    expect(title.type).toEqual(CardTitle);
    expect(title.props.children.type).toEqual(Search);

    const app2 = shallow(<A showOperation={false} />);
    expect(app2.contains(<Operation />)).toBeFalsy();
  });
});
```

**å¦‚ä½•è®©ä¸€ä¸ªé¡µé¢å¯æµ‹è¯•ï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰ï¼Ÿï¼Ÿï¼Ÿ**

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè®²é¡µé¢ç»„ä»¶æ‹†åˆ†æˆæœ€å°å•å…ƒï¼Œä¿è¯æ¯ä¸ªå°çš„ç»„ä»¶éƒ½æ˜¯å¯æ’æ‹”çš„ã€‚

![å•å…ƒæµ‹è¯•åˆ†äº«-ç›®å½•ç»“æ„](./image/mulu.png)

```javascript
import React from 'react';
import { Card } from 'antd';
import Form from './Form';
import Search from './Search';
import Operation from './Operation';
import List from './List';

const User = () => (
  <Card bordered={false} title={<Search />}>
    <Operation />
    <List />
    <Form />
  </Card>
);
export default User;
```

## å¿«ç…§æµ‹è¯•

> æ¯å½“ä½ æƒ³è¦ç¡®ä¿ä½ çš„ç”¨æˆ·ç•Œé¢ä¸ä¼šæœ‰æ„å¤–çš„æ”¹å˜ï¼Œå¿«ç…§æµ‹è¯•æ˜¯éå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚â€”â€” Jest Doc

æœ¬ä¾‹ä¸­ä½¿ç”¨ Jest çš„å¿«ç…§æµ‹è¯•è¿›è¡Œæµ‹è¯•

ä¾‹æˆ‘ä»¬æœ‰ä¸€ä¸ª Button ç»„ä»¶

```javascript
import React, { Component } from 'react';

export default class LinkButton extends Component {
  constructor() {
    super();
    this.state = { liked: false };
  }

  handleClick = () => {
    return this.setState({
      liked: !this.state.liked,
    });
  };

  render() {
    const text = this.state.liked ? 'like' : "haven't liked";
    return <p onClick={this.handleClick}>You {text} this.Click to toggle.</p>;
  }
}
```

ä¸Šé¢çš„ç»„ä»¶æ‹¥æœ‰ä¸‰ç§çŠ¶æ€ï¼Œåˆå§‹çŠ¶æ€ï¼Œç‚¹å‡»çŠ¶æ€ï¼Œä»¥åŠå†æ¬¡è¢«ç‚¹å‡»çš„çŠ¶æ€ã€‚ä¾æ­¤æˆ‘ä»¬ç”Ÿæˆä¸‰ç§çŠ¶æ€çš„å¿«ç…§ã€‚

```javascript
import React from 'react';
import renderer from 'react-test-renderer';
import LinkButton from '../LinkButton';
describe('<LinkButton/>', () => {
  it('Snapshot', () => {
    const component = renderer.create(<LinkButton />);

    let snapshot = component.toJSON();
    expect(snapshot).toMatchSnapshot();

    snapshot.props.onClick();
    snapshot = component.toJSON();
    expect(snapshot).toMatchSnapshot();

    snapshot.props.onClick();
    snapshot = component.toJSON();
    expect(snapshot).toMatchSnapshot();
  });
});
```

è¿è¡Œ

```
npm test
```

ä¹‹åä¼šç”Ÿæˆ

```
exports[`<LinkButton/> Snapshot 1`] = `
<p
  onClick={[Function bound handleClick]}>
  You
  haven\'t liked
   this.Click to toggle.
</p>
`;

exports[`<LinkButton/> Snapshot 2`] = `
<p
  onClick={[Function bound handleClick]}>
  You
  like
   this.Click to toggle.
</p>
`;

exports[`<LinkButton/> Snapshot 3`] = `
<p
  onClick={[Function bound handleClick]}>
  You
  haven\'t liked
   this.Click to toggle.
</p>
`;
```

æ­¤æ—¶å¦‚æœä¿®æ”¹ Button ç»„ä»¶å†…å®¹ï¼Œå†æ¬¡è¿è¡Œæµ‹è¯•ä¹‹åï¼Œæ§åˆ¶å°ä¼šæ˜¾ç¤ºæµ‹è¯•æœªé€šè¿‡ï¼Œå¹¶å°†ä¸¤æ¬¡å¿«ç…§ä¸åŒ¹é…çš„ä½ç½®æ ‡è®°å‡ºæ¥ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢æ— æ„é—´ä¿®æ”¹ç»„ä»¶çš„æŸäº›éƒ¨åˆ†

å¦‚æœéœ€è¦ä¿®æ”¹å¿«ç…§ï¼Œè¿è¡Œ

```
npm run test -- -u
```

## E2E å•å…ƒæµ‹è¯•

é—®é¢˜ï¼Ÿï¼Ÿå¦‚ä½•ç¡®å®šç”¨æˆ·å¯ä»¥é¡ºåˆ©èµ°å®Œä¸€ä¸ªè´­ä¹°æµç¨‹å‘¢?

1. æ‰“å¼€ç½‘é¡µ
2. æµè§ˆå•†å“
3. åŠ å…¥è´­ç‰©è½¦
4. ä¸‹å•ç¡®è®¤
5. ä»˜æ¬¾

å•çº¯ä¾é äººåŠ›æ¥æµ‹è¯•å®Œæ•´åŠŸèƒ½éå¸¸è€—æ—¶è€—åŠ›, è¿™æ—¶å€™è‡ªåŠ¨åŒ–æµ‹è¯•å°±ä½“ç°ä»·å€¼äº†

è‡ªåŠ¨åŒ–æµ‹è¯•æ˜¯æŠŠäººçš„æµ‹è¯•è¡Œä¸ºè½¬åŒ–ä¸ºæœºå™¨æ‰§è¡Œçš„ç¨‹åº, å¯ä»¥æé«˜æ•ˆç‡, è§£æ”¾ç”Ÿäº§åŠ›, èŠ‚çœäººåŠ›æˆæœ¬å’Œæ—¶é—´æˆæœ¬, é™ä½äººç±»æ˜“å‡ºé”™çš„é£é™©

ç°ä»£æ¯”è¾ƒæµè¡Œçš„ e2e æµ‹è¯•æ¡†æ¶æœ‰

- Nightwatch
- TestCafe
- Protractor
- WebdriverIO
- katalon
- Cypress
- Jest puppeteer

|     åç§°      |         æ–­è¨€          | è·¨æµè§ˆå™¨ |          å®ç°          |                      å®˜ç½‘                      | æ˜¯å¦å¼€æº |
| :-----------: | :-------------------: | :------: | :--------------------: | :--------------------------------------------: | :------: |
|  nightwatch   | assert å’Œ Chai Expect |    æ˜¯    |        selenium        |            http://nightwatchjs.org/            |    æ˜¯    |
|    cypress    | Chaiã€Chai-jQuery ç­‰  |    å¦    |         Chrome         |            https://www.cypress.io/             |    æ˜¯    |
|   testcafe    |     è‡ªå®šä¹‰çš„æ–­è¨€      |    æ˜¯    | ä¸æ˜¯åŸºäº selenium å®ç° |     https://devexpress.github.io/testcafe/     |    æ˜¯    |
|    katalon    |        TDD/BDD        |    æ˜¯    |           -            |    https://www.katalon.com/katalon-studio/     |    å¦    |
|  Protractor   | assert å’Œ Chai Expect |    æ˜¯    |        selenium        |     https://github.com/angular/protractor      |    å¦    |
|  WebdriverIO  | assert å’Œ Chai Expect |    æ˜¯    |        selenium        |             https://webdriver.io/              |    å¦    |
| jest-puppteer |       jest æ–­è¨€       |    æ˜¯    |         Chrome         | https://github.com/smooth-code/jest-puppeteer/ |    æ˜¯    |

### æµ‹è¯•å‰é¡»çŸ¥

1. é€šå¸¸ E2E æµ‹è¯•æ˜¯æˆ‘ä»¬æ­£å¸¸å¼€å‘å·²ç»å®Œæˆï¼Œæœ€å¥½æœ‰å®Œæ•´çš„æµ‹è¯•ç¯å¢ƒï¼ˆå¼€å‘ã€ç”Ÿäº§ï¼‰ã€‚
2. E2E æµ‹è¯•éœ€è¦æˆ‘ä»¬å¯¹æ•´ä¸ªä¸šåŠ¡é€»è¾‘éå¸¸ç†Ÿç»ƒï¼Œå³å¤šé¡µé¢ä¹‹é—´çš„äº¤äº’ç”šè‡³æ•´ä¸ªé¡¹ç›®æµç¨‹ã€‚

ä¸‹é¢ä»‹ç» 2 ç§ E2E æµ‹è¯•å·¥å…· Nightwatch åŠ Jest puppeteer

**Nightwatch**

```javascript
module.exports = {
  'test notFound page': (browser) => {
    browser
      .url('http://localhost:8080/xxxx')
      .maximizeWindow()
      .useXpath()
      .assert.containsText('//*[@id="app"]/div[3]/div[2]/h1', '404')
      .assert.containsText(
        '//*[@id="app"]/div[3]/div[2]/h2',
        'æŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨'
      )
      .pause(1000)
      .assert.urlContains('http://localhost:8080/xxxx')
      .click('//*[@id="app"]/div[3]/div[2]/div/button')
      .pause(1000)
      .assert.urlContains('http://localhost:8080/Home')
      .end();
  },
};
```

**Jest puppeteer**

```javascript
const pageUrl = `${protocal}://${host}:${port}`;
describe('goto page', () => {
  beforeAll(async () => {
    page = await browser.newPage();
    await page.setViewport({
      width: 1920,
      height: 1080,
    });
  });

  it('go to user page', async () => {
    await page.goto(`${pageUrl}/user`);
    await page.waitForSelector('label[for="account"]');
    await page.waitForSelector('label[for="name"]');
    await page.waitForSelector('label[for="mail"]');
    await page.waitForSelector('label[for="mobile"]');
  });

  it('coverage', async () => {
    await Promise.all([
      page.coverage.startJSCoverage(),
      page.coverage.startCSSCoverage(),
    ]);
    await page.goto(pageUrl);
    await page.hover('.ant-menu-root');
    await page.click('.ant-menu-item a[href="/user"]');
    // await jestPuppeteer.debug()
    const [jsCoverage, cssCoverage] = await Promise.all([
      page.coverage.stopJSCoverage(),
      page.coverage.stopCSSCoverage(),
    ]);
    const coverage = [...jsCoverage, ...cssCoverage];
    let totalBytes = 0;
    let usedBytes = 0;
    coverage.forEach((entry) => {
      totalBytes += entry.text.length;
      entry.ranges.forEach((range) => {
        usedBytes += range.end - range.start - 1;
      });
    });
    log(`Bytes used: ${(usedBytes / totalBytes) * 100}%`);
  });
});
```

## è¦†ç›–ç‡

å•å…ƒæµ‹è¯•è¦†ç›–ç‡æ˜¯ä¸€ç§è½¯ä»¶æµ‹è¯•çš„åº¦é‡æŒ‡æ ‡ï¼ŒæŒ‡åœ¨æ‰€æœ‰åŠŸèƒ½ä»£ç ä¸­ï¼Œå®Œæˆäº†å•å…ƒæµ‹è¯•çš„ä»£ç æ‰€å çš„æ¯”ä¾‹ã€‚æœ‰å¾ˆå¤šè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶å·¥å…·å¯ä»¥æä¾›è¿™ä¸€ç»Ÿè®¡æ•°æ®ï¼Œå…¶ä¸­æœ€åŸºç¡€çš„è®¡ç®—æ–¹å¼ä¸ºï¼š

> å•å…ƒæµ‹è¯•è¦†ç›–ç‡ = è¢«æµ‹ä»£ç è¡Œæ•° / å‚æµ‹ä»£ç æ€»è¡Œæ•° \* 100%

æµ‹è¯•è¦†ç›–ç‡åˆåˆ†ä¸º 3 ç§åº¦é‡æ–¹å¼ï¼š

1. è¯­å¥è¦†ç›–(StatemenCoverage) ä½“ç°å‚æµ‹ä»£ç ä¸­å·²è¢«æ‰§è¡Œå’Œæœªè¢«æ‰§è¡Œçš„ä»£ç è¡Œ
2. åˆ†æ”¯è¦†ç›–(DecisionCoverage) è¿™ç§è¦†ç›–ç‡ç»Ÿè®¡æ–¹å¼æ˜¯ç”¨äºç»Ÿè®¡ä»£ç ä¸­æ‰€æœ‰åˆ¤æ–­åˆ†æ”¯æ˜¯å¦éƒ½è¢«è¦†ç›–
3. æ¡ä»¶è¦†ç›–(ConditionCoverage) å®ƒåº¦é‡åˆ¤å®šä¸­çš„æ¯ä¸ªå­è¡¨è¾¾å¼ç»“æœ true å’Œ false æ˜¯å¦è¢«æµ‹è¯•åˆ°äº†

åœ¨è®¾ç½®å¥½ jest é…ç½®ä¹‹åï¼Œå½•å…¥éœ€è¦ç»Ÿè®¡è¦†ç›–ç‡çš„æ–‡ä»¶ï¼Œå³å¯ç»Ÿè®¡å•å…ƒæµ‹è¯•çš„è¦†ç›–ç‡ã€‚

å¯¹åº”çš„è¦†ç›–ç‡ç»Ÿè®¡å‘½ä»¤å¦‚ä¸‹ï¼š

```javascript
//vue-cli3
"coverage": "yarn run test:unit --coverage && node jest/openCoverage.js"
//react and vue-cli2
"coverage": "npx jest --coverage && node jest/openCoverage.js"
```

ç»Ÿè®¡ç»“æœå¦‚ä¸‹ï¼š
[å•å…ƒæµ‹è¯•è¦†ç›–ç‡ç»Ÿè®¡](./image/fugailv.png)

- Statements: è¯­å¥è¦†ç›–ç‡ï¼Œæ‰§è¡Œåˆ°æ¯ä¸ªè¯­å¥ï¼›
- Branches: åˆ†æ”¯è¦†ç›–ç‡ï¼Œæ‰§è¡Œåˆ°æ¯ä¸ª if ä»£ç å—ï¼›
- Functions: å‡½æ•°è¦†ç›–ç‡ï¼Œè°ƒç”¨åˆ°ç¨‹å¼ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°ï¼›
- Lines: è¡Œè¦†ç›–ç‡, æ‰§è¡Œåˆ°ç¨‹åºä¸­çš„æ¯ä¸€è¡Œã€‚

### ä¸€ä¸ªå°æ•…äº‹

[å°æ•…äº‹](https://www.artima.com/forums/flat.jsp?forum=106&thread=204677)

ä¸€å¤©æ—©ä¸Šï¼Œç¨‹åºå‘˜é—®å¤§å¸ˆï¼š<br/>
â€œæˆ‘å‡†å¤‡å†™ä¸€äº›å•å…ƒæµ‹è¯•äº†ã€‚æˆ‘åº”è¯¥ä»¥ä»€ä¹ˆæ ·çš„ä»£ç è¦†ç›–ç‡ä¸ºç›®æ ‡ï¼Ÿâ€œ<br/>
å¤§å¸ˆå›ç­”è¯´ï¼š<br/>
â€œä¸è¦æ‹…å¿ƒæŠ¥é“ï¼Œåªè¦å†™ä¸€äº›å¥½çš„æµ‹è¯•ã€‚â€<br/>
...<br/>
é‚£å¤©æ™šäº›æ—¶å€™ï¼Œç¬¬äºŒä¸ªç¨‹åºå‘˜é—®äº†åŒæ ·çš„é—®é¢˜ã€‚<br/>
å¤§å¸ˆæŒ‡ç€ä¸€ä¸ªçƒ§ç€å¼€æ°´çš„é”…è¯´ï¼š<br/>
â€œæˆ‘åº”è¯¥åœ¨é‚£ä¸ªé”…é‡Œæ”¾å‡ ç²’ç±³é¥­ï¼Ÿâ€<br/>
çœ‹èµ·æ¥å›°æƒ‘çš„ç¨‹åºå‘˜å›ç­”è¯´ï¼š<br/>
â€œæˆ‘æ€ä¹ˆå¯èƒ½å‘Šè¯‰ä½ ï¼Ÿè¿™å–å†³äºä½ éœ€è¦å–‚å¤šå°‘äººï¼Œä»–ä»¬æœ‰å¤šé¥¿ï¼Œä½ æ‰€æä¾›çš„å…¶ä»–é£Ÿç‰©ï¼Œä½ æœ‰å¤šå°‘ç±³ï¼Œç­‰ç­‰ã€‚<br/>
â€œæ²¡é”™ï¼Œâ€å¤§å¸ˆè¯´ã€‚<br/>
...<br/>
åœ¨ä¸€å¤©ç»“æŸæ—¶ï¼Œç¬¬ä¸‰ä½ç¨‹åºå‘˜æ¥åˆ°å¹¶è¯¢é—®æœ‰å…³ä»£ç è¦†ç›–ç‡çš„ç›¸åŒé—®é¢˜ã€‚<br/>
â€œç™¾åˆ†ä¹‹å…«åä¹Ÿä¸å°‘ï¼â€å¤§å¤§å¸ˆç”¨ä¸¥å‰çš„å£°éŸ³å›ç­”è¯´ï¼ŒæŠŠæ‹³å¤´ç ¸åœ¨æ¡Œå­ä¸Šã€‚<br/>
...<br/>
åœ¨æœ€åçš„å›å¤ä¹‹åï¼Œä¸€ä½å¹´è½»çš„å­¦å¾’æ‰¾åˆ°äº†è¿™ä½å¤§å¸ˆï¼š<br/>
â€œå¤§å¸ˆï¼Œä»Šå¤©æˆ‘æ— æ„ä¸­å¬åˆ°ä½ ç”¨ä¸‰ä¸ªä¸åŒçš„ç­”æ¡ˆå›ç­”äº†æœ‰å…³ä»£ç è¦†ç›–çš„ç›¸åŒé—®é¢˜ã€‚ä¸ºä»€ä¹ˆï¼Ÿâ€<br/>
è¿™ä½ä¼Ÿå¤§çš„å¤§å¸ˆå¼€å§‹å›ç­”ï¼š<br/>
â€œç¬¬ä¸€ä¸ªç¨‹åºå‘˜æ˜¯æ–°æ‰‹ï¼Œåˆšåˆšå¼€å§‹æµ‹è¯•ã€‚ç°åœ¨ä»–æœ‰å¾ˆå¤šä»£ç ï¼Œæ²¡æœ‰æµ‹è¯•ã€‚ä»–è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°; åœ¨è¿™ä¸ªæ—¶å€™ä¸“æ³¨äºä»£ç çš„è¦†ç›–ç‡å°†æ˜¯ä»¤äººæ²®ä¸§å’Œæ— ç”¨çš„ã€‚ä»–æœ€å¥½ä¹ æƒ¯äºç¼–å†™å’Œè¿è¡Œä¸€äº›æµ‹è¯•ã€‚ä»–ä»¥åå¯ä»¥æ‹…å¿ƒæŠ¥é“ã€‚â€œ<br/>
â€œå¦ä¸€æ–¹é¢ï¼Œç¬¬äºŒä¸ªç¨‹åºå‘˜åœ¨ç¼–ç¨‹å’Œæµ‹è¯•æ–¹é¢éƒ½éå¸¸æœ‰ç»éªŒã€‚å½“æˆ‘å›ç­”é—®å¥¹åº”è¯¥æ”¾å…¥å¤šå°‘ç²’ç±³é¥­æ—¶ï¼Œæˆ‘å¸®åŠ©å¥¹æ„è¯†åˆ°å¿…è¦çš„æµ‹è¯•é‡å–å†³äºè®¸å¤šå› ç´ ï¼Œå¥¹æ¯”æˆ‘æ›´äº†è§£è¿™äº›å› ç´  - æ¯•ç«Ÿè¿™æ˜¯å¥¹çš„ä»£ç ã€‚æ²¡æœ‰å•ä¸€ï¼Œç®€å•çš„ç­”æ¡ˆï¼Œè€Œä¸”å¥¹è¶³å¤Ÿèªæ˜ï¼Œå¯ä»¥å¤„ç†äº‹å®å¹¶ä»¥æ­¤ä¸ºä¾æ®ã€‚â€œ<br/>
â€œæˆ‘æ˜ç™½äº†ï¼Œâ€å¹´è½»çš„å­¦å¾’è¯´ï¼Œâ€œä½†å¦‚æœæ²¡æœ‰ä¸€ä¸ªç®€å•çš„ç­”æ¡ˆï¼Œé‚£ä½ ä¸ºä»€ä¹ˆå›ç­”ç¬¬ä¸‰ä¸ªç¨‹åºå‘˜'ç™¾åˆ†ä¹‹å…«åä¹Ÿä¸å°‘'ï¼Ÿâ€<br/>
â€œç¬¬ä¸‰ä¸ªç¨‹åºå‘˜åªæƒ³è¦ç®€å•çš„ç­”æ¡ˆ - å³ä½¿æ²¡æœ‰ç®€å•çš„ç­”æ¡ˆ......ç„¶åæ— è®ºå¦‚ä½•éƒ½ä¸ä¼šéµå¾ªå®ƒä»¬ã€‚â€

ç»“è®ºï¼š

- æµ‹è¯•è¦†ç›–ç‡å¯ä»¥è®©æˆ‘ä»¬è‡ªæ£€è·¯å¾„è¦†ç›–ã€åˆ¤å®šè¦†ç›–åŠè¯­å¥è¦†ç›–ï¼ŒæŒ‡å¯¼æˆ‘ä»¬æ›´å¥½çš„æå‰å‘ç°ä»£ç ä¸­çš„é—®é¢˜
- è¦†ç›–ç‡æ•°æ®åªèƒ½ä»£è¡¨ä½ æµ‹è¯•è¿‡å“ªäº›ä»£ç ï¼Œä¸èƒ½ä»£è¡¨ä½ æ˜¯å¦æµ‹è¯•å¥½è¿™äº›ä»£ç ã€‚
- ä¸è¦è¿‡äºç›¸ä¿¡è¦†ç›–ç‡æ•°æ®åŠåªæ‹¿è¯­å¥è¦†ç›–ç‡(è¡Œè¦†ç›–ç‡)æ¥è€ƒæ ¸æµ‹è¯•äººå‘˜ã€‚
- åˆ†æ”¯è¦†ç›–ç‡ > åˆ¤å®šè¦†ç›– > è¯­å¥è¦†ç›–

## é›†æˆæµ‹è¯•

é›†æˆæµ‹è¯•éœ€è¦ä¸€äº›ç¬¬ä¸‰æ–¹å·¥å…·æ‰€é…åˆï¼Œä¾‹å¦‚ï¼šgitlab é’©å­ï¼Œgithub é’©å­ï¼Œdocker ç­‰ç­‰

ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®æäº¤ä»£ç çš„ä¹‹å‰è¿›è¡Œå•å…ƒæµ‹è¯•

```javascript
"gitHooks": {
  "pre-push": "yarn test && yarn lint"
}
```

å¦å¤–è¿˜æœ‰ä¸€äº›æ¯”è¾ƒå¥½ç”¨çš„ç¬¬ä¸‰æ–¹é›†æˆæµ‹è¯•å¹³å°

[codecov](https://codecov.io/)
[coveralls](https://coveralls.io)

1. codecov
   ![vueé›†æˆæµ‹è¯•](./image/vue.png)
2. coveralls
   ![mobxé›†æˆæµ‹è¯•](./image/mobx.png)

## é™„å½•

### å•å…ƒæµ‹è¯•å¸¸ç”¨é…ç½®

```javascript
{
  //è¦†ç›–ç‡ç»Ÿè®¡æ–‡ä»¶å¤¹åŠæ–‡ä»¶
  "collectCoverageFrom": [
    "src/component/**/*.{js,jsx,mjs}",
    "src/page/**/*.{js,jsx,mjs}",
    "src/store/**/*.{js,jsx,mjs}",
    "src/storeProp/**/*.{js,jsx,mjs}",
    "src/mixin/**/*.{js,jsx,mjs}",
    "src/tool/**/*.{js,jsx,mjs}"
  ],
  //å…¥å£æ–‡ä»¶
  "setupFiles": [
    "<rootDir>/jest/setup.js"
  ],
  //æµ‹è¯•ä»£ç æ–‡ä»¶
  "testMatch": [
    "<rootDir>/__test__/**/?(*.)(spec|test).{js,jsx,ts,tsx}"
  ],
  //æµ‹è¯•Setupä¹‹åæ‰§è¡Œçš„æ–‡ä»¶
  "setupTestFrameworkScriptFile": "<rootDir>/jest/afterSetup.js",
  //ç”Ÿæˆdomæ‰€éœ€çš„åº“
  "testEnvironment": "enzyme",
  //æµ‹è¯•Url
  "testURL": "http://localhost",
  //è½¬æ¢ ES6->5 ts åŠ css æ–‡ä»¶
  "transform": {
    "^.+\\.(js|jsx|mjs)$": "<rootDir>/node_modules/babel-7-jest",
    "^.+\\.tsx?$": "ts-jest",
    "^.+\\.(css|less)$": "<rootDir>/jest/cssTransform.js"
  },
  //ä¸è½¬æ¢çš„æ–‡ä»¶
  "transformIgnorePatterns": [
    "<rootDir>/node_modules/(?!lodash-es/).+(js|jsx|mjs)$"
  ],
  //åˆ«åï¼Œç±»ä¼¼äºalias
  "moduleNameMapper": {
    "^component/(.+)$": "<rootDir>/src/component/$1",
    "^tool/(.+)$": "<rootDir>/src/tool/$1",
    "^store/(.+)$": "<rootDir>/src/store/$1",
    "^page/(.+)$": "<rootDir>/src/page/$1",
    "^mixin/(.+)$": "<rootDir>/src/mixin/$1",
    "^storeProp/(.+)$": "<rootDir>/src/storeProp/$1",
    "^src/(.+)$": "<rootDir>/src/$1",
    "^locale/(.+)$": "<rootDir>/src/locale/$1",
    "^fixture/(.+)$": "<rootDir>/__test__/fixture/$1",
    "history/createBrowserHistory": "<rootDir>/node_modules/history/createMemoryHistory",
    "^.+\\.less$": "identity-obj-proxy"
  },
  //åç¼€ï¼Œç±»ä¼¼äºextensions
  "moduleFileExtensions": [
    "js",
    "json",
    "jsx",
    "ts",
    "tsx"
  ],
  //æµ‹è¯•å®Œæ¯•åæ¸…é™¤mocks
  "clearMocks": true,
  //Resets Mocks
  "restoreMocks": true
},
```

### Vue ç»„ä»¶æµ‹è¯• DEMO

```vue
<template>
  <div class="ConfirmButton">
    <el-popover placement="top" width="160" v-model="visible2">
      <p>{{ onConfirmText }}</p>
      <div class="confirmBtn">
        <el-button size="mini" type="text" @click="visible2 = false"
          >å–æ¶ˆ</el-button
        >
        <el-button
          type="primary"
          class="confirmBtn"
          size="mini"
          @click="onClick"
          >ç¡®å®š</el-button
        >
      </div>
      <el-button slot="reference">
        <slot />
      </el-button>
    </el-popover>
  </div>
</template>

<script>
export default {
  name: 'ConfirmButton',
  props: {
    text: String,
    onConfirmText: String,
  },
  mounted() {},
  data() {
    return {
      visible2: false,
    };
  },
  methods: {
    onClick() {
      this.$emit('onConfirm');
      this.visible2 = false;
    },
  },
};
</script>

<style scoped lang="less" type="text/css">
.confirmBtn {
  margin: 0;
  text-align: right;
}
</style>
```

```javascript
import { mount } from '@vue/test-utils';

import ConfirmButton from 'src/components/ConfirmButton.vue';

describe('NoMatch.vue', () => {
  const wrapper = mount(ConfirmButton, {
    propsData: {
      text: 'æµ‹è¯•HOC',
      onConfirmText: 'ä½ ç¡®å®šè¦åˆ é™¤å—ï¼Ÿï¼Ÿ',
    },
    slots: {
      default: '<div class="fake-msg"></div>',
    },
  });
  const mockFn = jest.fn(() => {});
  wrapper.vm.$on('onConfirm', mockFn);

  it('æµ‹è¯•æ¥æ”¶åˆ°äº†propå‚æ•°', () => {
    expect(wrapper.props().text).toContain('æµ‹è¯•HOC');
    expect(wrapper.props().onConfirmText).toContain('ä½ ç¡®å®šè¦åˆ é™¤å—ï¼Ÿï¼Ÿ');
  });

  it('æµ‹è¯•slot', () => {
    const list = wrapper.find(ConfirmButton);
    expect(list.contains('div.fake-msg')).toBeTruthy();
  });

  it('æµ‹è¯•onClickï¼Œæ˜¯å¦è§¦å‘äº‹ä»¶', () => {
    wrapper.vm.visible2 = true;
    expect(mockFn).not.toHaveBeenCalled();
    wrapper
      .findAll('el-button')
      .at(1)
      .trigger('click');
    expect(mockFn).toHaveBeenCalled();
  });
});
```

<Valine></Valine>
